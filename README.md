# DOKDODAO Lottery Verification System

A CLI tool for independently verifying lottery results on the DOKDODAO platform.

## Overview

This tool verifies that lottery draws conducted on DOKDODAO campaigns or events were executed fairly.

- **Chainlink VRF** based verifiable random number generation
- **Merkle Tree** for participant data integrity verification
- Compare results against on-chain recorded data

## Installation

```bash
# Clone the repository
git clone https://github.com/pherateriw/lottery-verification.git
cd lottery-verification

# Install dependencies
pnpm install

# Build
pnpm build
```

## Usage

```bash
node dist/main.js <url>
```

### Examples

```bash
# Verify an event
node dist/main.js https://www.dokdodao.io/events/145076508687994880

# Verify a campaign
node dist/main.js https://www.dokdodao.io/campaigns/136376065879314455
```

### Options

```
-V, --version  Output version information
-h, --help     Display help for command
```

## How It Works

### 1. Fetch Participant Data

Retrieves the participant list and ticket counts for each participant from the API.

### 2. Calculate Merkle Root

Computes the Merkle Root based on participant data and compares it with the on-chain recorded value.

```
Leaf = keccak256(abi.encodePacked(participantId, ticketStart, ticketEnd))
```

### 3. Winner Selection

Winners are determined using the random seed generated by Chainlink VRF.

```
ticketIndex = keccak256(abi.encodePacked(seed, drawIndex)) % totalTickets
```

- Duplicate prevention: Already selected participants are excluded from subsequent draws
- Number of winners per prize tier is determined by prizeConfig

### 4. Result Verification

Confirms that calculated results match the results recorded on-chain.

## Development

```bash
# Development mode (auto-restart on file changes)
pnpm dev

# Type check
pnpm typecheck

# Build
pnpm build
```

## Tech Stack

- **Runtime**: Node.js
- **Language**: TypeScript
- **Build**: SWC
- **Blockchain**: ethers.js (keccak256, solidityPacked)
- **CLI**: Commander
- **Logging**: Pino
- **Validation**: Zod

## License

This source code is licensed under the DOKDODAO Source Available License.
See [LICENSE.md](LICENSE.md) for full terms.

## Author

SELVEDGE LAB PTE. LTD. (DOKDODAO)
Email: dokdo@dokdodao.io
